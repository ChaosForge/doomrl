--[[ The intro level is the first level a new WolfRL player will
     see (ideally) and so I've tried my best to make it flavorful.

     You're not expected to have more than a pistol leaving this
     level.  Due to the reduced dangers it will be a while before
     you score an MP40.  All you will find here are guards and
     dogs, the same as in regular Wolfenstein E1L1.
--]]

register_level "intro1" {
	name  = "Wolfenstein Dungeon",

	Create = function ()
		generator.fill( "void", area.FULL )
		--generator.fill( "floor", area.new( 8, 3, 79, 18 ) )

		local translation = {
			['.'] = "floor",
			[','] = "rock",
			["`"] = "void",
			[">"] = "stairs",
			['#'] = "wolf_blwall",
			['$'] = { "wolf_blwall", flags = { LFPERMANENT } },
			['&'] = "wolf_blwall", --todo flair
			['%'] = { "wolf_blwall", flags = { LFPERMANENT } }, --todo flair

			["+"] = "door",
			["="] = { "lmdoor1", flags = { LFPERMANENT } },
			["-"] = { "lmdoor2", flags = { LFPERMANENT } },

			['*'] = { "floor", item = "wolf_smed" },
			['D'] = { "floor", item = "wolf_food1" },
			['T'] = { "floor", item = "wolf_food2" },
			['|'] = { "floor", item = "wolf_9mm" },

			["a"] = {"floor", being = "wolf_guard1"},
			["b"] = {"floor", being = "wolf_dog1"},

			["1"] = {"floor", being = core.bydiff{nil, "wolf_guard1"}},
			["2"] = {"floor", being = core.bydiff{nil, nil, "wolf_guard1"}},
			["3"] = {"floor", being = core.bydiff{nil, nil, nil, "wolf_guard1"}},
			["4"] = {"floor", being = core.bydiff{nil, "wolf_dog1", "wolf_guard1"}},
			["5"] = {"floor", being = core.bydiff{nil, nil, "wolf_dog1", "wolf_guard1"}},
			["6"] = {"floor", being = core.bydiff{nil, nil, nil, "wolf_dog1"}},

			["q"] = "wolf_guard1corpse",
			["x"] = "bones1",
			["X"] = "bones2",
		}

		local frame = [[
```````````````````````$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
```````````````````````$...................................................$
```````````````````````$...................................................$
$$$$$$$$$$$$$$$$$$$$$$$$...................................................$
$..........................................................................$
$..........................................................................$
$..........................................................................$
$..........................................................................$
$..........................................................................$
$..........................................................................$
$..........................................................................$
$..........................................................................$
$..........................................................................$
$..........................................................................$
$..........................................................................$
$..........................................................................$
$$$$$$$$$$$$$$$$$$$$$$$$...................................................$
```````````````````````$...................................................$
```````````````````````$...................................................$
```````````````````````$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
]]
		local start = [[
#############
#,X,,#,T,#.1.
#,,,,#,,x#...
##+####+##...
+3...........
+4...........
##+####+##...
#,,,,#,q,#...
#xT,,#,,,#.2.
#############
]]
		local cellset = { [[
#,x#,,#,,#...
#,,#,,#,,#...
&#+##+##+#...
+............
]], [[
#,,,,#,,,#...
#,,,,#,,x#...
&#+####+##...
+............
]], [[
+........#,X,
&#+##+#..#,,,
#,,#X,#..+,,,
#,,#,,#..#,,,
]], [[
+.....#,x#...
&#+#..#,,#...
#,,#..##+#...
#,,#.........
]], }
		local hallway1 = { [[
######+#######
#.a...........
######+##.....
#.......###+##
]], [[
############+#
#.a...........
##+##.........
#...#####+####
]], [[
##+#########+#
#.............
#.a.##+##.....
##+##...######
]], [[
#.........####
#+#####+###...
#.a...........
############+#
]], [[
###+#####+####
#.a...........
#.............
###+#####+####
]], [[
#####+########
#.............
#.a...........
#####+########
]], [[
#...##########
##+##.........
#.a...##+##...
#######...####
]], }
		local roomset1 = { [[
#.............
#........2...*
##+###########
#.............
#.............
#.............
#.............
]], [[
#.............
#.........####
#....2....+...
#.........#,,,
#.........#,,,
########+##...
#........*#...
]], [[
#.....###.....
#.....#2......
#.....+.......
#....*#.......
#######.......
#.............
#.............
]], [[
#.............
#######.......
#....2+.......
#.....#*......
####+######...
#.........#...
#.........#...
]], }
		local door = [[
+
#
]]
		local validdoorspots1 = { 2, 5, 8, 13, 16, 19 }
		local roomset2 = { [[
#.........#..............
#.........#...########...
#.........#.....*##......
#b.......D#.....6##1.....
#####+#####...########...
#........................
#........................
]],[[
#6............#D..b.#....
#.............##...##.1..
#.............#.....#....
#.............##...##....
#............*#.....#....
###+#############+###....
#........................
]],[[
#...........6*#..........
##+#+##########.......1..
#....D#.......+..........
##+#+##..1....#+#######..
#.....................#..
#............b........#..
#.....................#..
]],[[
#........................
#.........###............
#.......1.###............
#........................
#................######..
##+######........+6..*#..
#b....D################..
]], }
		local hallway2 = { [[
###+#####################
#.........+............>.
#.........+...........a>.
###+#####################
]],[[
#.....................###
###+###################>.
#.........+...........a..
#.........###############
]],[[
#&+&#####################
#........###..+....###a>.
#........+....###..+.....
#&+&#####################
]],[[
#......#+################
#......#...............>.
#......#..............a##
#......#+###############.
]], }
		local validdoorspots2 = { 6, 8, 11, 13, 14, 16 }
		local bigroom = { [[
.........####.........
..5......+.*#.........
.........####.........
......................
##+#+#################
...|...+.....a........
.......+.....b........
##+#+#################
......................
.........####.........
..a......+.T#.........
.........####.........
]],[[
......................
.################+###.
.#*.................#.
.#...##........##...+.
.#...##5......b##...#.
.#...##........##...#.
.#...|....##........#.
.#.....a..##..a.....#.
.#........##........+.
.#T.................#.
.################+###.
......................
]],[[
.......#...#..........
.......#...#..........
..T....+...+..........
.......#...#..........
......a#..a###########
########..............
########..............
......5#..b###########
.......#...#..........
..*....+...+..........
.......#...#..........
.......#...#..........
]], }


		generator.place_tile( translation, frame, 3, 1 )
		generator.place_tile( translation, start, 65, 6 )
		generator.place_tile( translation, table.random_pick(cellset), 65, 2 )
		generator.place_tile( translation, table.random_pick(cellset), 65, 16 )
		generator.place_tile( translation, table.random_pick(hallway1), 51, 9 )
		generator.place_tile( translation, table.random_pick(roomset1), 51, 2 )
		generator.place_tile( translation, table.random_pick(roomset1), 51, 13 )
		generator.place_tile( translation, door, 51, table.random_pick(validdoorspots1) )
		generator.place_tile( translation, door, 51, table.random_pick(validdoorspots1) )
		generator.place_tile( translation, door, 51, table.random_pick(validdoorspots1) )
		generator.place_tile( translation, table.random_pick(hallway2), 26, 9 )
		generator.place_tile( translation, table.random_pick(roomset2), 26, 2 )
		generator.place_tile( translation, table.random_pick(roomset2), 26, 13 )
		generator.place_tile( translation, door, 26, table.random_pick(validdoorspots2) )
		generator.place_tile( translation, door, 26, table.random_pick(validdoorspots2) )
		generator.place_tile( translation, table.random_pick(bigroom), 4, 5 )
		level:player(72, 14)
	end,

	OnExit = function ()
		if statistics.damage_on_level == 0 then
			player:add_history("He vanished from his cell like a ghost.")
		else
			player:add_history("He slipped out of his cell.")
		end
	end,
}